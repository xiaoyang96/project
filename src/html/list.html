<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>列表页</title>
    <link rel="stylesheet" type="text/css" href="../css/base.css" />
    <link rel="stylesheet" type="text/css" href="../css/list.css" />
    <!-- <link rel="stylesheet" type="text/css" href="../css/list.css" /> -->
    <link rel="stylesheet" type="text/css" href="../font/font_2tc6l6ui9xdpldi/iconfont.css" />
    <script type="text/javascript" src="../js/require.js" data-main="../js/list"></script>

</head>
<body>
    <div class="common_header">
        <div class="header">
            <div class="container clear">
                <ul class="clear">
                    <li class="h_first">
                        <a href="html/login.html" style="color:#555;">您好，请登录</a>&nbsp;&nbsp;<a href="html/reg.html" style="color:#FF5B57">
                        <span>免费注册</span></a>
                    </li>
                    <li class="h_xl">
                        <a href="#"><span>我的订单<i class="iconfont icon-small-bottom-arrow"></i></span></a>
                        <ul>
                            <li><a href="#">待付款订单</a></li>
                            <li><a href="#">待确认收货</a></li>
                            <li><a href="#">待评价交易</a></li>
                        </ul>
                    </li>
                    <li class="h_xl">
                        <a href="#"><span>我的收藏<i class="iconfont icon-small-bottom-arrow"></i></span></a>
                        <ul>
                            <li><a href="#">商品收藏</a></li>
                            <li><a href="#">店铺收藏</a></li>
                        </ul>
                    </li>
                    <li class="h_xl">
                        <a href="#"><span>客户服务<i class="iconfont icon-small-bottom-arrow"></i></span></a>
                        <ul>
                            <li><a href="#">购物指南</a></li>
                            <li><a href="#">售后服务</a></li>
                            <li><a href="#">商家服务</a></li>
                        </ul>
                    </li>
                    <li>
                        <span><img src="../img/on2.png" /></span>
                        <a href="#">成为供应商</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="search">
            <div class="container clear">
                <div class="sl fl">
                    <a href="../index.html"><img src="../img/bed4afca2106a3cb0049d937c31e0f11.png"/></a>    
                </div>
                <div class="sm fl">
                   <div class="sm_top clear">
                       <span>
                            宝贝
                            <i class="iconfont icon-small-bottom-arrow"></i>
                       </span>
                       <input type="text" value="请输入您要搜索的商品关键字" />
                       <button>搜索</button>
                   </div>
                   <div class="sm_b">
                       <a href="#"><span>攀枝花凯特芒</span></a>
                       <a href="#"><span>清仓大促</span></a>
                       <a href="#"><span>CELLE西琳</span></a>
                       <a href="#"><span>破壁料理机</span></a>
                       <a href="#"><span>全球购</span></a>
                       <a href="#"><span>GUCCI</span></a>
                       <a href="#"><span>汉灸堂</span></a>
                       <a href="#"><span>达芬奇</span></a>
                   </div>
                </div>
                <div class="sr fr">
                    <a href="#"><span>
                        <i class="iconfont icon-shangcheng" style="color:#F27034"></i>
                        我的商城
                        <i class="iconfont icon-xiangshang"></i>
                    </span></a>
                    <a href="carlist.html"><span><i class="iconfont icon-gouwuche" style="color:#F27034"></i>
                        购物车结算
                        <i class="iconfont icon-xiangshang"></i>
                    </span></a>
                </div>
            </div>
        </div>
        <div class="nav">
            <div class="container clear">
                <h4 class="fl nav_l">
                    <a href="#"><span>所有商品分类</span></a>
                    <ul>
                        <li>
                            <a href="#">食品</a><span>/</span><a href="#">酒类</a><span>/</span><a href="#">饮料</a>
                            <div class="nav_ej">
                                <div class="nav_ej_l">
                                    
                                </div>
                                <div class="nav_ej_r">
                                    
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="#">家用电器</a><span>/</span><a href="#">厨房用具</a>
                            <div class="nav_ej">
                                <div class="nav_ej_l">
                                    
                                </div>
                                <div class="nav_ej_r">
                                    
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="#">珠宝首饰</a><span>/</span><a href="#">时尚钟表</a>
                            <div class="nav_ej">
                                <div class="nav_ej_l">
                                    
                                </div>
                                <div class="nav_ej_r">
                                    
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="#">个护美妆</a><span>/</span><a href="#">奢侈品</a><span>/</span><a href="#">箱包</a>
                            <div class="nav_ej">
                                <div class="nav_ej_l">
                                    
                                </div>
                                <div class="nav_ej_r">
                                    
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="#">服饰内衣</a><span>/</span><a href="#">流行鞋靴</a>
                        </li>
                        <li>
                            <a href="#">家居家装</a><span>/</span><a href="#">家具陈设</a>
                        </li>
                        <li>
                            <a href="#">文化收藏</a><span>/</span><a href="#">书画</a><span>/</span><a href="#">器物</a>
                        </li>
                        <li>
                            <a href="#">手机</a><span>/</span><a href="#">摄影数码</a><span>/</span><a href="#">电脑</a>
                        </li>
                        <li>
                            <a href="#">营养滋补</a><span>/</span><a href="#">保健器械</a>
                        </li>
                        <li>
                            <a href="#">运动户外</a><span>/</span><a href="#">健身器材</a>
                        </li>
                    </ul>
                </h4>
                <ul class="fl clear">
                    <li><a href="#"><span>首页</span></a></li>
                    <li><a href="#"><span>TV直播</span></a></li>
                    <li><a href="#"><span>品牌特卖</span></a></li>
                    <li><a href="#"><span>清仓大促</span></a></li>
                </ul> 
            </div>
        </div>
    </div>
    <div class="container">
        <div class="fenlei">
            <span>
                <a href="#">家用电器<i class="iconfont icon-small-bottom-arrow"></i></a>
                
                <ul class="clear">
                    <li><a href="">食品饮料</a></li>
                    <li><a href="">中外名酒</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                    <li><a href="">营养保健</a></li>
                </ul>
            </span>
        </div>
        <div class="select">
            <p class="select_top">
                分类- <span>“家用电器”</span>筛选结果
            </p>
            <div class="select_bot">
                <span>包含分类：</span>

            </div>
        </div>
        <div class="list_nav">
            <ul class="clear">
                <li>默认排序</li>
                <li>成交量</li>
                <li>价格</li>
                <li>评论</li>
                <li><input type="text" value="￥最低价" />-<input type="text" value="￥最高价"></li>
                <li>经营类型</li>
                <li>促销活动</li>
                <li><input type="checkbox" />赠品</li>
            </ul>
        </div>
        <div id="datalist"></div>
        <div id="page"></div>

    </div>
    




    <div class="common_footer">
        <div class="pic">
            <div class="container">
                <ul class="clear">
                    <li><a href="#"><img src="../img/qingsonggouwu.png" height="86" width="250" alt="" /></a></li>
                    <li><a href="#"><img src="../img/tiantiantejia.png" height="86" width="250" alt="" /></a></li>
                    <li><a href="#"><img src="../img/zhijianyanxuan.png" height="86" width="250" alt="" /></a></li>
                    <li><a href="#"><img src="../img/zhengpinbaozheng.png" height="86" width="250" alt="" /></a></li>
                </ul> 
            </div>
        </div>
        <div class="faq">
            <div class="container clear">
                <div class="notice fl">
                    <h3>公告</h3>
                    <ul>
                        <li><a href="#">【公告】关于8月15日至9月6日期间福建省厦门市停运通知</a></li>
                        <li><a href="#">【公告】央广购物会员体系升级 8月会员月会员福利全面升值</a></li>
                        <li><a href="#">【公告】央广购物天津有线频道位置前移至139 开启精彩新生活</a></li>
                        <li><a href="#">【公告】央广购物、天猫直播打造汽车节直播秀 快进中国汽车文化</a></li>
                    </ul>
                </div>
                <div class="link fl">
                    <ul class="clear">
                        <li>
                            <dl>
                                <dt>购物指南</dt>
                                <dd><a href="#">免费注册</a></dd>
                                <dd><a href="#">购物流程</a></dd>
                                <dd><a href="#">用户注册协议</a></dd>
                                <dd><a href="#">电子发票</a></dd>
                            </dl>
                        </li>
                        <li>
                            <dl>
                                <dt>商家服务</dt>
                                <dd><a href="#">招商标准</a></dd>
                                <dd><a href="#">平台总则</a></dd>
                                <dd><a href="#">入驻注意事项</a></dd>
                                <dd><a href="#">招商资质标准</a></dd>
                            </dl>
                        </li>
                        <li>
                            <dl>
                                <dt>支付配送</dt>
                                <dd><a href="#">支付方式</a></dd>
                                <dd><a href="#">配送范围</a></dd>
                                <dd><a href="#">配送时间</a></dd>
                                <dd><a href="#">购物卡</a></dd>
                            </dl>
                        </li>
                        <li>
                            <dl>
                                <dt>会员中心</dt>
                                <dd><a href="#">会员等级</a></dd>
                                <dd><a href="#">会员权益</a></dd>
                                <dd><a href="#">购物金</a></dd>
                                <dd><a href="#">找回密码</a></dd>
                            </dl>
                        </li>
                        <li>
                            <dl>
                                <dt>售后服务</dt>
                                <dd><a href="#">售后服务政策</a></dd>
                                <dd><a href="#">特色服务</a></dd>
                                <dd><a href="#">无忧购物</a></dd>
                                <dd><a href="#">权威监督</a></dd>
                            </dl>
                        </li>
                    </ul>
                </div>
            </div>  
        </div>
    </div>
    <div class="footer"></div>

    
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded',function(){
            var datalist = document.querySelector('#datalist');
            var page = document.querySelector('#page');

            var pageNo = 1;
            var qty = 15;
            // 发起ajax请求
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(xhr.readyState ===4 && (xhr.status === 200 || xhr.status === 304)){
                    var res = xhr.responseText;

                    try{
                        res = JSON.parse(res);
                    }catch(err){
                        try{
                            res = eval('(' + res + ')');
                        }catch(e){

                        }
                    }
                    // console.log(res);

                    // 写入页面
                    // 分页数量
                    page.innerHTML = '';
                    var pageQty = Math.ceil(res.total/qty);
                    for(var i=1;i<=pageQty;i++){
                        var span = document.createElement('span');
                        if(i==pageNo){
                            span.className = 'active';
                        }
                        span.innerText = i;

                        page.appendChild(span);
                    }
                    // 数据写入
                    var ul = document.createElement('ul');
                    ul.innerHTML = res.data.map(item=>{
                        return `<li data-guid = "${item.guid}">
                            <a href="datalist.html?giud=${item.guid}">
                            <img src="/project/src/img/${item.imgurl}"/></a>
                            <p class="price"><span>￥${item.price}</span></p>
                            <h4 class="title">${item.title}</h4>
                            <p class="tedian">${item.tedian}</p>
                            <p class="store">${item.store}</p>
                            <p><button>加入购物车</button></p>
                        </li>`
                    }).join('');

                    // imgurl=${item.imgurl}&title=${item.title}&tedian=${item.tedian}&price=${item.price}&store=${item.store}&goodsName=${item.title} 
                    
                    datalist.innerHTML = '';
                    datalist.appendChild(ul);

                }
            }

            xhr.open('get',`/project/src/api/list.php?pageNo=${pageNo}&qty=${qty}`,true);
            xhr.send();

            // 点击页码请求响应数据
            page.onclick = function(e){
                e = e || window.event;
                var target = e.target || e.srcElement;
                if(target.tagName.toLowerCase() === 'span'){

                    pageNo = target.innerText;
                    xhr.open('get',`/project/src/api/list.php?pageNo=${pageNo}&qty=${qty}`,true);
                    xhr.send();
                }
            }


            var arr_goods = [];
            datalist.onclick = function(e){
                e =e || window.event;
                var target = e.target || e.srcElement;
                if(target.tagName.toLowerCase() ==='button'){
                    var currentLi = target.parentNode.parentNode;

                    //获取点击按钮对应商品信息
                    var goods = {
                        guid:currentLi.getAttribute('data-guid'),
                        imgurl:currentLi.children[0].children[0].src,
                        title:currentLi.children[2].innerText,
                        price:currentLi.children[1].children[0].innerText
                    }
                    arr_goods.push(goods);

                    // * JSON.stringify() 把对象/数组转成json字符串
                    // * JSON.parse() 把“json字符串”转成对象/数组

                    //存入cookie
                    document.cookie = 'carlist' + JSON.stringify(arr_goods); 
                    console.log(goods);

                }
            }


        });
    </script>
    
</body>
</html>